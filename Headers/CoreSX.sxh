/#
===============================================
 CoreSX Standard Library for OCL
 Version: 0.0.1-beta
===============================================
 
 CoreSX is the REQUIRED standard library for
 all OCL programs. It provides essential I/O,
 error handling, and runtime support.
 
 This header is automatically included by the
 OCL compiler unless explicitly imported.
 
 Author: OCL Foundation
 License: MIT
 
===============================================
#/

#type Header CoreSX
#pragma once

/#
  System Metadata
#/
#system
    name: "CoreSX"
    author: "OCL Foundation"
    module: "core.standard"
    version: "0.0.1-beta"
    required: true
    description: "Core OCL Standard Library"
#end

/#
===============================================
  NAMESPACE: core.io
  Basic Input/Output Operations
===============================================
#/

#namespace core.io

    /#----------------------------------------
      Console Output Functions
    ----------------------------------------#/
    
    function print(text: string)
        /# 
          Prints text to stdout with newline
          
          Parameters:
            text - String to output
          
          Example:
            print("Hello, World!")
        #/
        try
            system.stdout.write(text)
            system.stdout.write("\n")
            system.stdout.flush()
        catch error
            system.stderr.write("[CoreSX Error] print failed\n")
        end
    end
    
    function printf(format: string, ...args)
        /# 
          Formatted output to stdout
          
          Parameters:
            format - Format string with placeholders
            args   - Values to format
          
          Example:
            printf("Value: %d", 42)
        #/
        try
            system.stdout.format(format, args)
            system.stdout.flush()
        catch error
            system.stderr.write("[CoreSX Error] printf failed\n")
        end
    end
    
    function println(text: string)
        /# 
          Alias for print() - prints with newline
        #/
        print(text)
    end
    
    /#----------------------------------------
      Error Output Functions
    ----------------------------------------#/
    
    function printerr(text: string)
        /# 
          Prints error message to stderr
          
          Parameters:
            text - Error message
          
          Example:
            printerr("Fatal error occurred")
        #/
        try
            system.stderr.write("[ERROR] ")
            system.stderr.write(text)
            system.stderr.write("\n")
            system.stderr.flush()
        catch
            /# Cannot handle stderr failure #/
        end
    end
    
    function warn(text: string)
        /# 
          Prints warning message to stderr
          
          Parameters:
            text - Warning message
          
          Example:
            warn("Deprecated function used")
        #/
        try
            system.stderr.write("[WARNING] ")
            system.stderr.write(text)
            system.stderr.write("\n")
            system.stderr.flush()
        catch
            /# Cannot handle stderr failure #/
        end
    end
    
    function debug(text: string)
        /# 
          Prints debug message (only in debug builds)
          
          Parameters:
            text - Debug message
        #/
        #if DEBUG
            system.stderr.write("[DEBUG] ")
            system.stderr.write(text)
            system.stderr.write("\n")
        #endif
    end

#endnamespace


/#
===============================================
  NAMESPACE: core.error
  Error Handling Support
===============================================
#/

#namespace core.error

    type ErrorCode enum
        SUCCESS = 0
        GENERIC_ERROR = 1
        IO_ERROR = 2
        MEMORY_ERROR = 3
        SYNTAX_ERROR = 4
        RUNTIME_ERROR = 5
    end
    
    function panic(message: string)
        /# 
          Immediately terminate with error message
          
          Parameters:
            message - Error message to display
          
          Example:
            panic("Unrecoverable error")
        #/
        system.stderr.write("\n[PANIC] ")
        system.stderr.write(message)
        system.stderr.write("\n")
        system.exit(1)
    end
    
    function assert(condition: bool, message: string)
        /# 
          Assert condition is true, panic if false
          
          Parameters:
            condition - Boolean condition
            message   - Error message if false
          
          Example:
            assert(x > 0, "X must be positive")
        #/
        if not condition then
            panic(message)
        end
    end

#endnamespace


/#
===============================================
  NAMESPACE: core.runtime
  Runtime Support Functions
===============================================
#/

#namespace core.runtime

    function version(): string
        /# 
          Returns OCL runtime version
          
          Returns:
            Version string (e.g., "0.0.1-beta")
        #/
        return "OCL 0.0.1-beta with CoreSX"
    end
    
    function exit(code: int)
        /# 
          Exit program with status code
          
          Parameters:
            code - Exit code (0 = success)
        #/
        system.exit(code)
    end

#endnamespace


/#
===============================================
  NAMESPACE: core.types
  Basic Type Utilities
===============================================
#/

#namespace core.types

    /# Type aliases for clarity #/
    type int8   = byte
    type int16  = short
    type int32  = int
    type int64  = long
    type uint8  = ubyte
    type uint16 = ushort
    type uint32 = uint
    type uint64 = ulong
    type float32 = float
    type float64 = double
    
    /# String type (built-in) #/
    type string = builtin.string

#endnamespace


/#
===============================================
  GLOBAL CONSTANTS
===============================================
#/

#constant TRUE = 1
#constant FALSE = 0
#constant NULL = 0

#constant MAX_INT = 2147483647
#constant MIN_INT = -2147483648


/#
===============================================
  COMPILER DIRECTIVES
===============================================
#/

/# 
  Tell compiler that CoreSX provides essential
  runtime support. Programs compiled without
  CoreSX will fail.
#/
#pragma coresx_loaded
#pragma stdlib_version "0.0.1"

/#
  Export commonly used functions to global scope
  so they don't need namespace qualification
#/
#export core.io.print as print
#export core.io.printf as printf
#export core.io.printerr as printerr
#export core.error.panic as panic
#export core.runtime.exit as exit


/#
===============================================
  INITIALIZATION CODE
===============================================
#/

/# This code runs before main() #/
#init
    /# Initialize runtime #/
    system.runtime.init()
    
    /# Setup signal handlers #/
    system.signal.setup()
    
    /# Register cleanup #/
    system.atexit(core.runtime.cleanup)
#end


/#
===============================================
  CLEANUP CODE
===============================================
#/

/# This code runs after main() or on exit #/
#cleanup
    /# Flush all streams #/
    system.stdout.flush()
    system.stderr.flush()
    
    /# Release resources #/
    system.runtime.shutdown()
#end


/#
===============================================
  END OF CoreSX STANDARD LIBRARY
===============================================
  
  All OCL programs implicitly depend on this
  library. Do not remove or modify unless you
  know what you're doing!
  
===============================================
#/